name: CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  workflow_dispatch:

env:
  global_env: global

jobs:
#   sys_info:
#     runs-on: windows-latest
#     env:
#       local_env: ${{ github.job }}
#     steps:
#       # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
#       - uses: actions/checkout@v3
        
#       - name: working directory
#         run: |
#           pwd
#           ls
#       - name: print env
#         run: env
#       - name : check tools
#         run: g++ -v
      
  build-win:
    runs-on: windows-latest
    # needs: [sys_info]
    
    steps:
      - uses: actions/checkout@v3
    
      - name: build
        run: |
          cl main.cpp -o app_${{ runner.os }}_ver.${{ github.run_number }}
      - name: Download a Build Artifact
        uses: actions/upload-artifact@v3.0.0
        with:
          name: my_app
          path: main.exe
          retention-days: 1
          
  build-ubuntu:
    runs-on: ubuntu-latest
    # needs: [sys_info]
    
    steps:
      - uses: actions/checkout@v3
    
      - name: build
        run: |
          g++ main.cpp -o app_${{ runner.os }}_ver.${{ github.run_number }}
          ./app_${{ runner.os }}_ver.${{ github.run_number }}
      - name: Download a Build Artifact
        uses: actions/upload-artifact@v3.0.0
        with:
          name: my_app
          path: app_${{ runner.os }}_ver.${{ github.run_number }}
          retention-days: 1
          
  build-macos:
    runs-on: macos-latest
    # needs: [sys_info]
    
    steps:
      - uses: actions/checkout@v3
    
      - name: build
        run: |
          g++ main.cpp -o app_${{ runner.os }}_ver.${{ github.run_number }}
          ./app_${{ runner.os }}_ver.${{ github.run_number }}
      - name: Download a Build Artifact
        uses: actions/upload-artifact@v3.0.0
        with:
          name: my_app
          path: app_${{ runner.os }}_ver.${{ github.run_number }}
          retention-days: 1

#   test:
#     runs-on: windows-latest
#     needs: [sys_info, build]
#     steps:
#       - name: run_test
#         run: sleep 20
  #export:
    #runs-on: windows-latest
    
  
